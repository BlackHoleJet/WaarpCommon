<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Nov 8, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20131108" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://www.waarp.it" id="bannerLeft">
                                                <img src="images/waarp.jpg" alt="Waarp Project" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                
                <div class="xleft">
        <span id="publishDate">Last Published: 2013-11-08</span>
                  &nbsp;| <span id="projectVersion">Version: 1.2.19</span>
                      </div>
            <div class="xright">                    <a href="http://www.waarp.it/" class="externalLink" title="Waarp">Waarp</a>
              
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                
                                <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
                          <a href="changes-report.html" title="Changes Report">Changes Report</a>
            </li>
                      <li class="none">
                          <a href="dev-activity.html" title="Developer Activity">Developer Activity</a>
            </li>
                      <li class="none">
                          <a href="file-activity.html" title="File Activity">File Activity</a>
            </li>
                      <li class="none">
                          <a href="changelog.html" title="Change Log">Change Log</a>
            </li>
                      <li class="none">
                          <a href="taglist.html" title="Tag List">Tag List</a>
            </li>
                      <li class="none">
                          <a href="api/index.html" title="JavaDocs">JavaDocs</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 4.3.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\json\JsonHandler.java</td><td><a href="./xref/org/waarp/common/json/JsonHandler.html#47">47</a></td></tr><tr class="a"><td>org\waarp\common\json\SmileJsonHandler.java</td><td><a href="./xref/org/waarp/common/json/SmileJsonHandler.html#48">48</a></td></tr><tr class="b"><td colspan='2'><div><pre>	public final static ObjectMapper mapper = new ObjectMapper();

	static {
		mapper.configure(JsonParser.Feature.ALLOW_SINGLE_QUOTES, true);
		mapper.configure(JsonParser.Feature.ALLOW_UNQUOTED_FIELD_NAMES, true);
		mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
	}
	/**
	 * 
	 * @return an empty ObjectNode
	 */
	public final static ObjectNode createObjectNode() {
		return mapper.createObjectNode();
	}
	
	/**
	 * 
	 * @param value
	 * @return the objectNode or null if an error occurs
	 */
	public final static ObjectNode getFromString(String value) {
		try {
			return (ObjectNode) mapper.readTree(value);
		} catch (JsonProcessingException e) {
			return null;
		} catch (IOException e) {
			return null;
		}
	}
	/**
	 * 
	 * @param object
	 * @return the Json representation of the object
	 */
	public final static String writeAsString(Object object) {
		try {
			return mapper.writeValueAsString(object);
		} catch (JsonProcessingException e) {
			return &quot;&quot;;
		}
	}
	
	/**
	 * 
	 * @param node
	 * @param field
	 * @return the String if the field exists, else null
	 */
	public final static String getString(ObjectNode node, String field) {
		return getValue(node, field, (String) null);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @return the String if the field exists, else null
	 */
	public final static String getString(ObjectNode node, Enum&lt;?&gt; field) {
		return getValue(node, field.name(), (String) null);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the String if the field exists, else defValue
	 */
	public final static String getValue(ObjectNode node, String field, String defValue) {
		JsonNode elt = node.get(field);
		if (elt != null) {
			String val = elt.asText();
			if (val.equals(&quot;null&quot;)) {
				return defValue;
			}
			return val;
		}
		return defValue;
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Boolean if the field exists, else defValue
	 */
	public final static Boolean getValue(ObjectNode node, String field, boolean defValue) {
		return node.path(field).asBoolean(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Double if the field exists, else defValue
	 */
	public final static Double getValue(ObjectNode node, String field, double defValue) {
		return node.path(field).asDouble(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Long if the field exists, else defValue
	 */
	public final static Long getValue(ObjectNode node, String field, long defValue) {
		return node.path(field).asLong(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Integer if the field exists, else defValue
	 */
	public final static Integer getValue(ObjectNode node, String field, int defValue) {
		return node.path(field).asInt(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the byte array if the field exists, else defValue
	 */
	public final static byte[] getValue(ObjectNode node, String field, byte []defValue) {
		JsonNode elt = node.get(field);
		if (elt != null) {
			try {
				return elt.binaryValue();
			} catch (IOException e) {
				return defValue;
			}
		}
		return defValue;
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, String field, boolean value) {
		node.put(field, value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, String field, double value) {
		node.put(field, value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, String field, int value) {
		node.put(field, value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, String field, long value) {
		node.put(field, value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, String field, String value) {
		if (value == null || value.isEmpty()) {
			return;
		}
		node.put(field, value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, String field, byte []value) {
		if (value == null || value.length == 0) {
			return;
		}
		node.put(field, value);
	}
	
	/**
	 * 
	 * @param node
	 * @param field
	 * @return True if all fields exist
	 */
	public final static boolean exist(ObjectNode node, String ...field) {
		for (String string : field) {
			if (! node.has(string))
				return false;
		}
		return true;
	}
	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the String if the field exists, else defValue
	 */
	public final static String getValue(ObjectNode node, Enum&lt;?&gt; field, String defValue) {
		return getValue(node, field.name(), defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Boolean if the field exists, else defValue
	 */
	public final static Boolean getValue(ObjectNode node, Enum&lt;?&gt; field, boolean defValue) {
		return node.path(field.name()).asBoolean(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Double if the field exists, else defValue
	 */
	public final static Double getValue(ObjectNode node, Enum&lt;?&gt; field, double defValue) {
		return node.path(field.name()).asDouble(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Long if the field exists, else defValue
	 */
	public final static Long getValue(ObjectNode node, Enum&lt;?&gt; field, long defValue) {
		return node.path(field.name()).asLong(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the Integer if the field exists, else defValue
	 */
	public final static Integer getValue(ObjectNode node, Enum&lt;?&gt; field, int defValue) {
		return node.path(field.name()).asInt(defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param defValue
	 * @return the byte array if the field exists, else defValue
	 */
	public final static byte[] getValue(ObjectNode node, Enum&lt;?&gt; field, byte []defValue) {
		return getValue(node, field.name(), defValue);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, Enum&lt;?&gt; field, boolean value) {
		node.put(field.name(), value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, Enum&lt;?&gt; field, double value) {
		node.put(field.name(), value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, Enum&lt;?&gt; field, int value) {
		node.put(field.name(), value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, Enum&lt;?&gt; field, long value) {
		node.put(field.name(), value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, Enum&lt;?&gt; field, String value) {
		if (value == null || value.isEmpty()) {
			return;
		}
		node.put(field.name(), value);
	}

	/**
	 * 
	 * @param node
	 * @param field
	 * @param value
	 */
	public final static void setValue(ObjectNode node, Enum&lt;?&gt; field, byte []value) {
		if (value == null || value.length == 0) {
			return;
		}
		node.put(field.name(), value);
	}
	
	/**
	 * 
	 * @param node
	 * @param field
	 * @return True if all fields exist
	 */
	public final static boolean exist(ObjectNode node, Enum&lt;?&gt; ...field) {
		for (Enum&lt;?&gt; enm : field) {
			if (! node.has(enm.name()))
				return false;
		}
		return true;
	}

	/**
	 * 
	 * @param value
	 * @return the corresponding HashMap
	 */
	public final static Map&lt;String, Object&gt; getMapFromString(String value) {
		if (value != null &amp;&amp; ! value.isEmpty()) {
			Map&lt;String, Object&gt; info = null;
			try {
				info = mapper.readValue(value, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {});
			} catch (JsonParseException e1) {
			} catch (JsonMappingException e1) {
			} catch (IOException e1) {
			}
			if (info == null) {
				info = new HashMap&lt;String, Object&gt;();
			}
			return info;
		} else {
			return new HashMap&lt;String, Object&gt;();
		}
	}
	
	
}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#164">164</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#170">170</a></td></tr><tr class="b"><td colspan='2'><div><pre>	}


	protected static enum DBType {
		CHAR(Types.CHAR, &quot; CHAR(3) &quot;),
		VARCHAR(Types.VARCHAR, &quot; VARCHAR(254) &quot;),
		LONGVARCHAR(Types.LONGVARCHAR, &quot; TEXT &quot;),
		BIT(Types.BIT, &quot; BOOLEAN &quot;),
		TINYINT(Types.TINYINT, &quot; TINYINT &quot;),
		SMALLINT(Types.SMALLINT, &quot; SMALLINT &quot;),
		INTEGER(Types.INTEGER, &quot; INTEGER &quot;),
		BIGINT(Types.BIGINT, &quot; BIGINT &quot;),
		REAL(Types.REAL, &quot; FLOAT &quot;),
		DOUBLE(Types.DOUBLE, &quot; DOUBLE &quot;),
		VARBINARY(Types.VARBINARY, &quot; BLOB &quot;),
		DATE(Types.DATE, &quot; DATE &quot;),
		TIMESTAMP(Types.TIMESTAMP, &quot; TIMESTAMP &quot;);

		public int type;

		public String constructor;

		private DBType(int type, String constructor) {
			this.type = type;
			this.constructor = constructor;
		}

		public static String getType(int sqltype) {
			switch (sqltype) {
				case Types.CHAR:
					return CHAR.constructor;
				case Types.VARCHAR:
					return VARCHAR.constructor;
				case Types.LONGVARCHAR:
					return LONGVARCHAR.constructor;
				case Types.BIT:
					return BIT.constructor;
				case Types.TINYINT:
					return TINYINT.constructor;
				case Types.SMALLINT:
					return SMALLINT.constructor;
				case Types.INTEGER:
					return INTEGER.constructor;
				case Types.BIGINT:
					return BIGINT.constructor;
				case Types.REAL:
					return REAL.constructor;
				case Types.DOUBLE:
					return DOUBLE.constructor;
				case Types.VARBINARY:
					return VARBINARY.constructor;
				case Types.DATE:
					return DATE.constructor;
				case Types.TIMESTAMP:
					return TIMESTAMP.constructor;
				default:
					return null;
			}
		}
	}

	private final ReentrantLock lock = new ReentrantLock();

	public void createTables(DbSession session) throws WaarpDatabaseNoConnectionException {
		// Create tables: configuration, hosts, rules, runner, cptrunner
		String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;
		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Example
		String action = createTableH2 + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] ccolumns = DbDataModel.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbDataModel.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbDataModel.dbTypes[ccolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		logger.warn(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} finally {
			request.close();
		}
		// Index Example
		action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] icolumns = DbDataModel.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// example sequence
		/*
		 * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
		 * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
		 * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
		 * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
		 * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
		 */
		action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +
				&quot;seq BIGINT NOT NULL)&quot;;
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} finally {
			request.close();
		}
		action = &quot;INSERT INTO Sequences (name, seq) VALUES ('&quot; + DbDataModel.fieldseq + &quot;', &quot; +
				(DbConstant.ILLEGALVALUE + 1) + &quot;)&quot;;
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} finally {
			request.close();
		}
	}

	public void resetSequence(DbSession session, long newvalue)
			throws WaarpDatabaseNoConnectionException {
		String action = &quot;UPDATE Sequences SET seq = &quot; + newvalue +
				&quot; WHERE name = '&quot; + DbDataModel.fieldseq + &quot;'&quot;;
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;ResetSequence Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;ResetSequence Error&quot;, e);
			return;
		} finally {
			request.close();
		}
		logger.warn(action);
	}

	public synchronized long nextSequence(DbSession dbSession)
			throws WaarpDatabaseNoConnectionException,
			WaarpDatabaseSqlException, WaarpDatabaseNoDataException {
		lock.lock();
		try {
			long result = DbConstant.ILLEGALVALUE;
			String action = &quot;SELECT seq FROM Sequences WHERE name = '&quot; +
					DbDataModel.fieldseq + &quot;' FOR UPDATE&quot;;
			DbPreparedStatement preparedStatement = new DbPreparedStatement(
					dbSession);
			try {
				dbSession.conn.setAutoCommit(false);
			} catch (SQLException e1) {
			}
			try {
				preparedStatement.createPrepareStatement(action);
				// Limit the search
				preparedStatement.executeQuery();
				if (preparedStatement.getNext()) {
					try {
						result = preparedStatement.getResultSet().getLong(1);
					} catch (SQLException e) {
						throw new WaarpDatabaseSqlException(e);
					}
				} else {
					throw new WaarpDatabaseNoDataException(
							&quot;No sequence found. Must be initialized first&quot;);
				}
			} finally {
				preparedStatement.realClose();
			}
			action = &quot;UPDATE Sequences SET seq = &quot; + (result + 1) +
					&quot; WHERE name = '&quot; + DbDataModel.fieldseq + &quot;'&quot;;
			try {
				preparedStatement.createPrepareStatement(action);
				// Limit the search
				preparedStatement.executeUpdate();
			} finally {
				preparedStatement.realClose();
			}
			return result;
		} finally {
			try {
				dbSession.conn.setAutoCommit(true);
			} catch (SQLException e1) {
			}
			lock.unlock();
		}
	}

	@Override
	protected String validConnectionString() {
		return &quot;select 1 from dual&quot;;
	}

	public String limitRequest(String allfields, String request, int nb) {
		if (nb == 0) return request;
		return request + &quot; LIMIT &quot; + nb;
	}

}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#230">230</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#235">235</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#174">174</a></td></tr><tr class="a"><td colspan='2'><div><pre>		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Example
		String action = createTableH2 + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] ccolumns = DbDataModel.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbDataModel.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbDataModel.dbTypes[ccolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		logger.warn(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} finally {
			request.close();
		}
		// Index Example
		action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] icolumns = DbDataModel.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// example sequence
		/*
		 * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
		 * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
		 * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
		 * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
		 * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
		 */
		action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\file\filesystembased\FilesystemBasedFileImpl.java</td><td><a href="./xref/org/waarp/common/file/filesystembased/FilesystemBasedFileImpl.html#371">371</a></td></tr><tr class="b"><td>org\waarp\common\file\passthrough\PassthroughBasedFileImpl.java</td><td><a href="./xref/org/waarp/common/file/passthrough/PassthroughBasedFileImpl.html#302">302</a></td></tr><tr class="a"><td colspan='2'><div><pre>			long newposition = ((FilesystemBasedRestartImpl) restart)
					.getPosition();
			try {
				setPosition(newposition);
			} catch (IOException e) {
				throw new Reply502Exception(&quot;Cannot set the marker position&quot;);
			}
			return true;
		} catch (NoRestartException e) {
		}
		return false;
	}

	public boolean retrieve() throws CommandAbstractException {
		checkIdentify();
		if (isReady) {
			restartMarker(getSession().getRestart());
			return canRead();
		}
		return false;
	}

	public boolean store() throws CommandAbstractException {
		checkIdentify();
		if (isReady) {
			restartMarker(getSession().getRestart());
			return canWrite();
		}
		return false;
	}

	public DataBlock readDataBlock() throws FileTransferException,
			FileEndOfTransferException {
		if (isReady) {
			DataBlock dataBlock = new DataBlock();
			ChannelBuffer buffer = null;
			buffer = getBlock(getSession().getBlockSize());
			if (buffer != null) {
				dataBlock.setBlock(buffer);
				if (dataBlock.getByteCount() &lt; getSession().getBlockSize()) {
					dataBlock.setEOF(true);
				}
				return dataBlock;
			}
		}
		throw new FileTransferException(&quot;No file is ready&quot;);
	}

	public void writeDataBlock(DataBlock dataBlock)
			throws FileTransferException {
		if (isReady) {
			if (dataBlock.isEOF()) {
				writeBlockEnd(dataBlock.getBlock());
				return;
			}
			writeBlock(dataBlock.getBlock());
			return;
		}
		throw new FileTransferException(&quot;No file is ready&quot;);
	}

	/**
	 * Valid Position of this file
	 */
	private long position = 0;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\crypto\DynamicKeyManager.java</td><td><a href="./xref/org/waarp/common/crypto/DynamicKeyManager.html#62">62</a></td></tr><tr class="b"><td>org\waarp\common\crypto\KeyManager.java</td><td><a href="./xref/org/waarp/common/crypto/KeyManager.html#54">54</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public List&lt;String&gt; initFromList(List&lt;String&gt; keys, String extension) {
		LinkedList&lt;String&gt; wrong = new LinkedList&lt;String&gt;();
		for (String filename : keys) {
			File file = new File(filename);
			if (file.canRead()) {
				String basename = file.getName();
				int lastpos = basename.lastIndexOf(extension);
				if (lastpos &lt;= 0) {
					wrong.add(filename);
					continue;
				}
				String firstname = basename.substring(0, lastpos - 1);
				int len = (int) file.length();
				byte[] key = new byte[len];
				FileInputStream inputStream = null;
				try {
					inputStream = new FileInputStream(file);
				} catch (FileNotFoundException e) {
					// should not be
					wrong.add(filename);
					continue;
				}
				int read = 0;
				int offset = 0;
				while (read &gt; 0) {
					try {
						read = inputStream.read(key, offset, len);
					} catch (IOException e) {
						wrong.add(filename);
						read = -2;
						break;
					}
					offset += read;
					if (offset &lt; len) {
						len -= read;
					} else {
						break;
					}
				}
				try {
					inputStream.close();
				} catch (IOException e) {
				}
				if (read &lt; -1) {
					// wrong
					continue;
				}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelOracle.html#198">198</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#124">124</a></td></tr><tr class="a"><td colspan='2'><div><pre>		VARBINARY(Types.VARBINARY, &quot; BLOB &quot;),
		DATE(Types.DATE, &quot; DATE &quot;),
		TIMESTAMP(Types.TIMESTAMP, &quot; TIMESTAMP &quot;);

		public int type;

		public String constructor;

		private DBType(int type, String constructor) {
			this.type = type;
			this.constructor = constructor;
		}

		public static String getType(int sqltype) {
			switch (sqltype) {
				case Types.CHAR:
					return CHAR.constructor;
				case Types.VARCHAR:
					return VARCHAR.constructor;
				case Types.LONGVARCHAR:
					return LONGVARCHAR.constructor;
				case Types.BIT:
					return BIT.constructor;
				case Types.TINYINT:
					return TINYINT.constructor;
				case Types.SMALLINT:
					return SMALLINT.constructor;
				case Types.INTEGER:
					return INTEGER.constructor;
				case Types.BIGINT:
					return BIGINT.constructor;
				case Types.REAL:
					return REAL.constructor;
				case Types.DOUBLE:
					return DOUBLE.constructor;
				case Types.VARBINARY:
					return VARBINARY.constructor;
				case Types.DATE:
					return DATE.constructor;
				case Types.TIMESTAMP:
					return TIMESTAMP.constructor;
				default:
					return null;
			}
		}
	}

	public void createTables(DbSession session) throws WaarpDatabaseNoConnectionException {
		// Create tables: configuration, hosts, rules, runner, cptrunner
		String createTableH2 = &quot;CREATE TABLE &quot;;
		String constraint = &quot; CONSTRAINT &quot;;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#177">177</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#182">182</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelOracle.html#197">197</a></td></tr><tr class="b"><td colspan='2'><div><pre>		DOUBLE(Types.DOUBLE, &quot; DOUBLE &quot;),
		VARBINARY(Types.VARBINARY, &quot; BLOB &quot;),
		DATE(Types.DATE, &quot; DATE &quot;),
		TIMESTAMP(Types.TIMESTAMP, &quot; TIMESTAMP &quot;);

		public int type;

		public String constructor;

		private DBType(int type, String constructor) {
			this.type = type;
			this.constructor = constructor;
		}

		public static String getType(int sqltype) {
			switch (sqltype) {
				case Types.CHAR:
					return CHAR.constructor;
				case Types.VARCHAR:
					return VARCHAR.constructor;
				case Types.LONGVARCHAR:
					return LONGVARCHAR.constructor;
				case Types.BIT:
					return BIT.constructor;
				case Types.TINYINT:
					return TINYINT.constructor;
				case Types.SMALLINT:
					return SMALLINT.constructor;
				case Types.INTEGER:
					return INTEGER.constructor;
				case Types.BIGINT:
					return BIGINT.constructor;
				case Types.REAL:
					return REAL.constructor;
				case Types.DOUBLE:
					return DOUBLE.constructor;
				case Types.VARBINARY:
					return VARBINARY.constructor;
				case Types.DATE:
					return DATE.constructor;
				case Types.TIMESTAMP:
					return TIMESTAMP.constructor;
				default:
					return null;
			}
		}
	}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelH2.html#196">196</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#227">227</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#232">232</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public void createTables(DbSession session) throws WaarpDatabaseNoConnectionException {
		// Create tables: configuration, hosts, rules, runner, cptrunner
		String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;
		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Example
		String action = createTableH2 + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] ccolumns = DbDataModel.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbDataModel.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbDataModel.dbTypes[ccolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		logger.warn(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} finally {
			request.close();
		}

		// Index example
		action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbDataModel.table + &quot;(&quot;;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#178">178</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#183">183</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#124">124</a></td></tr><tr class="b"><td colspan='2'><div><pre>		VARBINARY(Types.VARBINARY, &quot; BLOB &quot;),
		DATE(Types.DATE, &quot; DATE &quot;),
		TIMESTAMP(Types.TIMESTAMP, &quot; TIMESTAMP &quot;);

		public int type;

		public String constructor;

		private DBType(int type, String constructor) {
			this.type = type;
			this.constructor = constructor;
		}

		public static String getType(int sqltype) {
			switch (sqltype) {
				case Types.CHAR:
					return CHAR.constructor;
				case Types.VARCHAR:
					return VARCHAR.constructor;
				case Types.LONGVARCHAR:
					return LONGVARCHAR.constructor;
				case Types.BIT:
					return BIT.constructor;
				case Types.TINYINT:
					return TINYINT.constructor;
				case Types.SMALLINT:
					return SMALLINT.constructor;
				case Types.INTEGER:
					return INTEGER.constructor;
				case Types.BIGINT:
					return BIGINT.constructor;
				case Types.REAL:
					return REAL.constructor;
				case Types.DOUBLE:
					return DOUBLE.constructor;
				case Types.VARBINARY:
					return VARBINARY.constructor;
				case Types.DATE:
					return DATE.constructor;
				case Types.TIMESTAMP:
					return TIMESTAMP.constructor;
				default:
					return null;
			}
		}
	}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelH2.html#199">199</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#174">174</a></td></tr><tr class="b"><td colspan='2'><div><pre>		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Example
		String action = createTableH2 + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] ccolumns = DbDataModel.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbDataModel.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbDataModel.dbTypes[ccolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		logger.warn(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} finally {
			request.close();
		}

		// Index example
		action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbDataModel.table + &quot;(&quot;;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelH2.html#275">275</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#249">249</a></td></tr><tr class="b"><td colspan='2'><div><pre>			logger.warn(&quot;ResetSequences Error&quot;, e);
			return;
		} finally {
			request.close();
		}
		logger.warn(action);
	}

	public long nextSequence(DbSession dbSession)
			throws WaarpDatabaseNoConnectionException,
			WaarpDatabaseSqlException, WaarpDatabaseNoDataException {
		long result = DbConstant.ILLEGALVALUE;
		String action = &quot;SELECT NEXTVAL('&quot; + DbDataModel.fieldseq + &quot;')&quot;;
		DbPreparedStatement preparedStatement = new DbPreparedStatement(
				dbSession);
		try {
			preparedStatement.createPrepareStatement(action);
			// Limit the search
			preparedStatement.executeQuery();
			if (preparedStatement.getNext()) {
				try {
					result = preparedStatement.getResultSet().getLong(1);
				} catch (SQLException e) {
					throw new WaarpDatabaseSqlException(e);
				}
				return result;
			} else {
				throw new WaarpDatabaseNoDataException(
						&quot;No sequence found. Must be initialized first&quot;);
			}
		} finally {
			preparedStatement.realClose();
		}
	}

	@Override
	protected String validConnectionString() {
		return &quot;select 1&quot;;
	}

	public String limitRequest(String allfields, String request, int nb) {
		if (nb == 0) return request;
		return request + &quot; LIMIT &quot; + nb;
	}

}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelH2.html#147">147</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#180">180</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#185">185</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelOracle.html#200">200</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#126">126</a></td></tr><tr class="a"><td colspan='2'><div><pre>		BLOB(Types.BLOB, &quot; BLOB &quot;);

		public int type;

		public String constructor;

		private DBType(int type, String constructor) {
			this.type = type;
			this.constructor = constructor;
		}

		public static String getType(int sqltype) {
			switch (sqltype) {
				case Types.CHAR:
					return CHAR.constructor;
				case Types.VARCHAR:
					return VARCHAR.constructor;
				case Types.LONGVARCHAR:
					return LONGVARCHAR.constructor;
				case Types.BIT:
					return BIT.constructor;
				case Types.TINYINT:
					return TINYINT.constructor;
				case Types.SMALLINT:
					return SMALLINT.constructor;
				case Types.INTEGER:
					return INTEGER.constructor;
				case Types.BIGINT:
					return BIGINT.constructor;
				case Types.REAL:
					return REAL.constructor;
				case Types.DOUBLE:
					return DOUBLE.constructor;
				case Types.VARBINARY:
					return VARBINARY.constructor;
				case Types.DATE:
					return DATE.constructor;
				case Types.TIMESTAMP:
					return TIMESTAMP.constructor;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelOracle.html#274">274</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#198">198</a></td></tr><tr class="a"><td colspan='2'><div><pre>			return;
		} finally {
			request.close();
		}
		// Index example
		action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] icolumns = DbDataModel.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// example sequence
		action = &quot;CREATE SEQUENCE &quot; + DbDataModel.fieldseq +
				&quot; MINVALUE &quot; + (DbConstant.ILLEGALVALUE + 1) +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\tar\TarUtility.java</td><td><a href="./xref/org/waarp/common/tar/TarUtility.html#134">134</a></td></tr><tr class="b"><td>org\waarp\common\tar\TarUtility.java</td><td><a href="./xref/org/waarp/common/tar/TarUtility.html#183">183</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public static boolean createTarFromFiles(List&lt;File&gt; files, String filename) {
		File saveFile = new File(filename);
		// recursive call
		TarArchiveOutputStream taos;
		try {
			taos = new TarArchiveOutputStream(new FileOutputStream(saveFile));
		} catch (FileNotFoundException e) {
			return false;
		}
		taos.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);
		for (File file : files) {
			try {
				addFile(file, taos);
			} catch (IOException e) {
				try {
					taos.close();
				} catch (IOException e1) {
					// ignore
				}
				return false;
			}
		}
		try {
			taos.finish();
		} catch (IOException e1) {
			// ignore
		}
		try {
			taos.flush();
		} catch (IOException e) {
			// ignore
		}
		try {
			taos.close();
		} catch (IOException e) {
			// ignore
		}
		return true;
	}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\tar\ZipUtility.java</td><td><a href="./xref/org/waarp/common/tar/ZipUtility.html#132">132</a></td></tr><tr class="b"><td>org\waarp\common\tar\ZipUtility.java</td><td><a href="./xref/org/waarp/common/tar/ZipUtility.html#179">179</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public static boolean createZipFromFiles(List&lt;File&gt; files, String filename) {
		File saveFile = new File(filename);
		ZipArchiveOutputStream zaos;
		try {
			zaos = new ZipArchiveOutputStream(new FileOutputStream(saveFile));
		} catch (FileNotFoundException e) {
			return false;
		}
		for (File file : files) {
			try {
				addFile(file, zaos);
			} catch (IOException e) {
				try {
					zaos.close();
				} catch (IOException e1) {
					// ignore
				}
				return false;
			}
		}
		try {
			zaos.finish();
		} catch (IOException e1) {
			// ignore
		}
		try {
			zaos.flush();
		} catch (IOException e) {
			// ignore
		}
		try {
			zaos.close();
		} catch (IOException e) {
			// ignore
		}
		return true;
	}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#254">254</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#259">259</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelOracle.html#274">274</a></td></tr><tr class="b"><td colspan='2'><div><pre>			return;
		} finally {
			request.close();
		}
		// Index Example
		action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] icolumns = DbDataModel.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// example sequence
		/*
		 * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
		 * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
		 * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
		 * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
		 * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
		 */
		action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\file\filesystembased\FilesystemBasedFileImpl.java</td><td><a href="./xref/org/waarp/common/file/filesystembased/FilesystemBasedFileImpl.html#141">141</a></td></tr><tr class="a"><td>org\waarp\common\file\passthrough\PassthroughBasedFileImpl.java</td><td><a href="./xref/org/waarp/common/file/passthrough/PassthroughBasedFileImpl.html#134">134</a></td></tr><tr class="b"><td colspan='2'><div><pre>	}

	public void clear() throws CommandAbstractException {
		closeFile();
		isReady = false;
		currentFile = null;
		isAppend = false;
	}

	public void checkIdentify() throws Reply530Exception {
		if (!getSession().getAuth().isIdentified()) {
			throw new Reply530Exception(&quot;User not authentified&quot;);
		}
	}

	public SessionInterface getSession() {
		return session;
	}

	public DirInterface getDir() {
		return dir;
	}

	/**
	 * Get the File from this path, checking first its validity
	 * 
	 * @param path
	 * @return the FileInterface
	 * @throws CommandAbstractException
	 */
	protected File getFileFromPath(String path) throws CommandAbstractException {
		String newdir = getDir().validatePath(path);
		String truedir = auth.getAbsolutePath(newdir);
		return new File(truedir);
	}

	/**
	 * Get the relative path (without mount point)
	 * 
	 * @param file
	 * @return the relative path
	 */
	protected String getRelativePath(File file) {
		return auth.getRelativePath(FilesystemBasedDirImpl.normalizePath(file</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\json\AdaptativeJsonHandler.java</td><td><a href="./xref/org/waarp/common/json/AdaptativeJsonHandler.html#522">522</a></td></tr><tr class="a"><td>org\waarp\common\json\JsonHandler.java</td><td><a href="./xref/org/waarp/common/json/JsonHandler.html#421">421</a></td></tr><tr class="b"><td>org\waarp\common\json\SmileJsonHandler.java</td><td><a href="./xref/org/waarp/common/json/SmileJsonHandler.html#422">422</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public final Map&lt;String, Object&gt; getMapFromString(String value) {
		if (value != null &amp;&amp; ! value.isEmpty()) {
			Map&lt;String, Object&gt; info = null;
			try {
				info = mapper.readValue(value, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {});
			} catch (JsonParseException e1) {
			} catch (JsonMappingException e1) {
			} catch (IOException e1) {
			}
			if (info == null) {
				info = new HashMap&lt;String, Object&gt;();
			}
			return info;
		} else {
			return new HashMap&lt;String, Object&gt;();
		}
	}
	
	
}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelH2.html#249">249</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#223">223</a></td></tr><tr class="a"><td colspan='2'><div><pre>				&quot; START WITH &quot; + (DbConstant.ILLEGALVALUE + 1);
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} finally {
			request.close();
		}
	}

	public void resetSequence(DbSession session, long newvalue)
			throws WaarpDatabaseNoConnectionException {
		String action = &quot;ALTER SEQUENCE &quot; + DbDataModel.fieldseq +
				&quot; RESTART WITH &quot; + newvalue;
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;ResetSequences Error&quot;, e);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelH2.html#229">229</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#259">259</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#264">264</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelOracle.html#279">279</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#203">203</a></td></tr><tr class="b"><td colspan='2'><div><pre>		action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] icolumns = DbDataModel.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		logger.warn(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			logger.warn(&quot;CreateTables Error&quot;, e);
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// example sequence
		action = &quot;CREATE SEQUENCE IF NOT EXISTS &quot; + DbDataModel.fieldseq +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\file\filesystembased\FilesystemBasedDirImpl.java</td><td><a href="./xref/org/waarp/common/file/filesystembased/FilesystemBasedDirImpl.html#253">253</a></td></tr><tr class="a"><td>org\waarp\common\file\passthrough\PassthroughBasedDirImpl.java</td><td><a href="./xref/org/waarp/common/file/passthrough/PassthroughBasedDirImpl.html#163">163</a></td></tr><tr class="b"><td colspan='2'><div><pre>		return ((FilesystemBasedAuthImpl) getSession().getAuth())
				.getRelativePath(normalizePath(file.getAbsolutePath()));
	}

	public boolean changeDirectory(String path) throws CommandAbstractException {
		checkIdentify();
		String newpath = consolidatePath(path);
		List&lt;String&gt; paths = wildcardFiles(newpath);
		if (paths.size() != 1) {
			logger.warn(&quot;CD error: {}&quot;, newpath);
			throw new Reply550Exception(&quot;Directory not found: &quot; + paths.size() +
					&quot; founds&quot;);
		}
		String extDir = paths.get(0);
		extDir = this.validatePath(extDir);
		if (isDirectory(extDir)) {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\common\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelH2.html#199">199</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelMariadb.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMariadb.html#230">230</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelMysql.html#235">235</a></td></tr><tr class="a"><td>org\waarp\common\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelOracle.html#249">249</a></td></tr><tr class="b"><td>org\waarp\common\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/common/database/model/DbModelPostgresql.html#174">174</a></td></tr><tr class="a"><td colspan='2'><div><pre>		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Example
		String action = createTableH2 + DbDataModel.table + &quot;(&quot;;
		DbDataModel.Columns[] ccolumns = DbDataModel.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbDataModel.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbDataModel.dbTypes[ccolumns.length - 1]) +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\file\filesystembased\FilesystemBasedDirImpl.java</td><td><a href="./xref/org/waarp/common/file/filesystembased/FilesystemBasedDirImpl.html#288">288</a></td></tr><tr class="b"><td>org\waarp\common\file\passthrough\PassthroughBasedDirImpl.java</td><td><a href="./xref/org/waarp/common/file/passthrough/PassthroughBasedDirImpl.html#188">188</a></td></tr><tr class="a"><td colspan='2'><div><pre>	}

	public String mkdir(String directory) throws CommandAbstractException {
		checkIdentify();
		String newdirectory = consolidatePath(directory);
		File dir = new File(newdirectory);
		String parent = dir.getParentFile().getPath();
		List&lt;String&gt; paths = wildcardFiles(normalizePath(parent));
		if (paths.size() != 1) {
			throw new Reply550Exception(&quot;Base Directory not found: &quot; +
					paths.size() + &quot; founds&quot;);
		}
		String newDir = paths.get(0) + SEPARATOR + dir.getName();
		newDir = this.validatePath(newDir);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\file\filesystembased\FilesystemBasedDirImpl.java</td><td><a href="./xref/org/waarp/common/file/filesystembased/FilesystemBasedDirImpl.html#217">217</a></td></tr><tr class="b"><td>org\waarp\common\file\passthrough\PassthroughBasedDirImpl.java</td><td><a href="./xref/org/waarp/common/file/passthrough/PassthroughBasedDirImpl.html#130">130</a></td></tr><tr class="a"><td colspan='2'><div><pre>		String truedir = ((FilesystemBasedAuthImpl) getSession().getAuth())
				.getAbsolutePath(newdir);
		return new File(truedir);
	}

	/**
	 * Get the true file from the path
	 * 
	 * @param path
	 * @return the true File from the path
	 * @throws CommandAbstractException
	 */
	protected File getTrueFile(String path) throws CommandAbstractException {
		checkIdentify();
		String newpath = consolidatePath(path);
		List&lt;String&gt; paths = wildcardFiles(normalizePath(newpath));
		if (paths.size() != 1) {
			throw new Reply550Exception(&quot;File not found: &quot; + paths.size() +
					&quot; founds&quot;);
		}
		String extDir = paths.get(0);
		extDir = this.validatePath(extDir);
		File file = getFileFromPath(extDir);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\database\data\AbstractDbData.java</td><td><a href="./xref/org/waarp/common/database/data/AbstractDbData.html#217">217</a></td></tr><tr class="b"><td>org\waarp\common\database\data\AbstractDbDataWithCommit.java</td><td><a href="./xref/org/waarp/common/database/data/AbstractDbDataWithCommit.html#84">84</a></td></tr><tr class="a"><td colspan='2'><div><pre>			isSaved = true;
		} finally {
			preparedStatement.realClose();
		}
	}

	/**
	 * Update object to table
	 * 
	 * @throws WaarpDatabaseException
	 */
	public void update() throws WaarpDatabaseException {
		if (isSaved) {
			return;
		}
		if (dbSession == null) {
			isSaved = true;
			return;
		}
		setToArray();
		DbPreparedStatement preparedStatement = new DbPreparedStatement(
				dbSession);
		try {
			preparedStatement.createPrepareStatement(&quot;UPDATE &quot; + getTable() +
					&quot; SET &quot; + getUpdateAllFields() + &quot; WHERE &quot; +
					getWherePrimaryKey());
			setValues(preparedStatement, allFields);
			int count = preparedStatement.executeUpdate();
			if (count &lt;= 0) {
				throw new WaarpDatabaseNoDataException(&quot;No row found&quot;);
			}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\common\tar\TarUtility.java</td><td><a href="./xref/org/waarp/common/tar/TarUtility.html#280">280</a></td></tr><tr class="b"><td>org\waarp\common\tar\ZipUtility.java</td><td><a href="./xref/org/waarp/common/tar/ZipUtility.html#274">274</a></td></tr><tr class="a"><td colspan='2'><div><pre>					&quot;   option=3 means tar and source is a list of files comma separated&quot;);
			System.exit(1);
		}
		int option = Integer.parseInt(args[0]);
		String tarfile = args[1];
		String tarsource = args[2];
		String[] tarfiles = null;
		if (option == 3) {
			tarfiles = args[2].split(&quot;,&quot;);
			File[] files = new File[tarfiles.length];
			for (int i = 0; i &lt; tarfiles.length; i++) {
				files[i] = new File(tarfiles[i]);
			}
			if (createTarFromFiles(files, tarfile)) {</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2009-2013
                        <a href="http://www.waarp.it">Waarp</a>.
            All Rights Reserved.      
                
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
